<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deed of Absolute Sale</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', serif;
            background: #f0f0f0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .controls {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #4CAF50;
            color: white;
        }

        .btn-preview {
            background: #2196F3;
            color: white;
        }

        .btn-download-png {
            background: #FF9800;
            color: white;
        }

        .btn-download-pdf {
            background: #f44336;
            color: white;
        }

        button:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        .document {
            background: white;
            padding: 60px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            min-height: 1100px;
        }

        .document-title {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 30px;
            letter-spacing: 2px;
        }

        .section-title {
            font-weight: bold;
            margin: 20px 0 10px 0;
            text-align: center;
        }

        .text-content {
            text-align: justify;
            line-height: 1.8;
            margin: 15px 0;
            font-size: 13px;
        }

        .field-input {
            border: none;
            border-bottom: 1px solid #333;
            background: transparent;
            font-family: inherit;
            font-size: inherit;
            padding: 2px 5px;
            min-width: 200px;
        }

        .field-input:focus {
            outline: none;
            border-bottom: 2px solid #2196F3;
        }

        .field-input.editing {
            background: #fffacd;
        }

        .vehicle-details {
            margin: 15px 0;
            padding-left: 40px;
        }

        .signature-section {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
            gap: 40px;
        }

        .signature-box {
            flex: 1;
            text-align: center;
        }

        .signature-canvas {
            border: 2px solid #333;
            cursor: crosshair;
            background: white;
            display: block;
            margin: 10px auto;
        }

        .signature-img {
            max-width: 200px;
            max-height: 80px;
            border: 1px solid #ddd;
            display: block;
            margin: 10px auto;
        }

        .signature-label {
            margin-top: 10px;
            font-size: 12px;
            border-top: 1px solid #333;
            padding-top: 5px;
            display: inline-block;
            min-width: 150px;
        }

        .clear-btn {
            padding: 5px 10px;
            font-size: 11px;
            margin-top: 5px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .acknowledgment {
            margin-top: 50px;
            page-break-before: always;
        }

        .ack-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .ack-table td {
            border: 1px solid #333;
            padding: 8px;
            font-size: 13px;
        }

        .notary-section {
            margin-top: 40px;
            text-align: left;
        }

        .doc-info {
            margin-top: 30px;
            font-size: 12px;
            line-height: 1.5;
        }

        .notary-stamp {
            display: inline-block;
            border: 2px solid #000;
            padding: 15px;
            background: white;
        }

        .notary-seal {
            margin-bottom: 10px;
        }

        .seal-circle {
            width: 120px;
            height: 120px;
            border: 3px solid #000;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            margin: 0 auto;
            padding: 10px;
        }

        .seal-text-top {
            position: absolute;
            top: 15px;
            font-size: 9px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .seal-center {
            text-align: center;
            line-height: 1.2;
        }

        .seal-text-bottom {
            position: absolute;
            bottom: 15px;
            font-size: 9px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .notary-info {
            text-align: center;
            font-size: 11px;
            line-height: 1.4;
            margin-top: 10px;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .controls {
                display: none;
            }
            .document {
                box-shadow: none;
                padding: 40px;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            width: 80%;
            max-width: 800px;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <div class="btn-group">
                <button class="btn-edit" onclick="toggleEdit()">‚úèÔ∏è Edit Document</button>
                <button class="btn-preview" onclick="previewDocument()">üëÅÔ∏è Preview</button>
                <button class="btn-download-png" onclick="downloadPNG()">üì∑ Download PNG</button>
                <button class="btn-download-pdf" onclick="downloadPDF()">üìÑ Download PDF</button>
            </div>
        </div>

        <div class="document" id="document">
            <!-- Page 1 -->
            <div class="document-title">DEED OF ABSOLUTE SALE</div>
            
            <div class="section-title">KNOW ALL MEN BY THESE PRESENTS:</div>
            
            <div class="text-content">
                This <strong>Deed of Absolute Sale</strong> is made and entered into in Lipa City
                this <input type="text" class="field-input" id="day" placeholder="___"> day of 
                <input type="text" class="field-input" id="month" placeholder="___"> by and between:
            </div>

            <div class="text-content" style="padding-left: 40px;">
                <input type="text" class="field-input" id="seller-name" placeholder="___" style="min-width: 300px;">, 
                of legal age, Filipino, with residence address at 
                <input type="text" class="field-input" id="seller-address" placeholder="___" style="min-width: 400px;"> 
                hereinafter referred to as SELLER;
            </div>

            <div class="text-content" style="text-align: center; margin: 20px 0;">
                <strong>- and -</strong>
            </div>

            <div class="text-content" style="padding-left: 40px;">
                <input type="text" class="field-input" id="buyer-name" placeholder="___" style="min-width: 300px;">, 
                of legal age, Filipino, with residence address at 
                <input type="text" class="field-input" id="buyer-address" placeholder="___" style="min-width: 400px;"> 
                hereinafter referred to as BUYER;
            </div>

            <div class="section-title">WITNESSETH:</div>

            <div class="text-content">
                <strong>WHEREAS,</strong> the SELLER is the absolute and registered owner of the following motor vehicle, more particularly described as follows:
            </div>

            <div class="vehicle-details">
                MODEL/MAKE: <input type="text" class="field-input" id="model" placeholder="___" style="min-width: 250px;"><br>
                COLOR: <input type="text" class="field-input" id="color" placeholder="___" style="min-width: 250px;"><br>
                BODY: <input type="text" class="field-input" id="body" placeholder="___" style="min-width: 250px;"><br>
                MOTOR NO. : <input type="text" class="field-input" id="motor-no" placeholder="___" style="min-width: 250px;"><br>
                SERIAL/CHASSIS NO. : <input type="text" class="field-input" id="chassis-no" placeholder="___" style="min-width: 250px;"><br>
                PLATE NO. : <input type="text" class="field-input" id="plate-no" placeholder="___" style="min-width: 250px;">
            </div>

            <div class="text-content">
                <strong>WHEREAS,</strong> the SELLER desires to sell the aforesaid motor vehicle and the BUYER is able, willing and ready to purchase the same for the terms and conditions herein below set forth;
            </div>

            <div class="text-content">
                <strong>NOW THEREFORE,</strong> for and in consideration of the sum total of 
                <input type="text" class="field-input" id="amount" placeholder="___" style="min-width: 200px;"> 
                (PHP <input type="text" class="field-input" id="amount-words" placeholder="___" style="min-width: 300px;">), Philippine currency, VAT inclusive; and receipt hereof is hereby acknowledged by the said SELLER, the SELLER hereby SELL, CEDE, TRANSFER and CONVEY unto the BUYER, in a manner absolute and irrevocable the above-described Motor Vehicle, free from any and all liens and encumbrances whatsoever and on an "AS IS WHERE IS BASIS".
            </div>

            <div class="text-content">
                The SELLER warrants that the Motor Vehicle is free from any liens and encumbrances and that said SELLER shall defend the title and rights of the BUYER from any claims of whatever kind or nature from third persons.
            </div>

            <!-- Page 2 -->
            <div class="acknowledgment">
                <div class="text-content">
                    UNLESS Unit of [MAKE, MODEL, BODY] free from any and all liens and encumbrances whatsoever.
                </div>

                <div class="text-content">
                    The SELLER warrants that the Motor Vehicle is free from any liens and encumbrances and that said SELLER shall defend the title and rights of the BUYER from any claims of whatever kind or nature from third persons.
                </div>

                <div class="text-content">
                    <strong>IN WITNESS WHEREOF,</strong> the parties have hereunto affixed their signatures on the date and at the place first above-written.
                </div>

                <div class="signature-section">
                    <div class="signature-box">
                        <div><strong>[NAME OF SELLER]</strong></div>
                        <div>Seller</div>
                        <canvas id="sellerCanvas" class="signature-canvas" width="200" height="80"></canvas>
                        <button class="clear-btn" onclick="clearSignature('sellerCanvas')">Clear</button>
                    </div>
                    <div class="signature-box">
                        <div><strong>[NAME OF BUYER]</strong></div>
                        <div>Buyer</div>
                        <canvas id="buyerCanvas" class="signature-canvas" width="200" height="80"></canvas>
                        <button class="clear-btn" onclick="clearSignature('buyerCanvas')">Clear</button>
                    </div>
                </div>

                <div class="section-title" style="margin-top: 50px;">SIGNED IN THE PRESENCE OF:</div>

                <div class="signature-section" style="margin-top: 20px;">
                    <div class="signature-box">
                        <div>1. <input type="text" class="field-input" id="witness1" placeholder="___"></div>
                        <div class="signature-label">Witness</div>
                    </div>
                    <div class="signature-box">
                        <div>2. <input type="text" class="field-input" id="witness2" placeholder="___"></div>
                        <div class="signature-label">Witness</div>
                    </div>
                </div>

                <div class="section-title" style="margin-top: 60px;">ACKNOWLEDGMENT</div>

                <div class="text-content">
                    Republic of the Philippines)<br>
                    Lipa City) S.S.
                </div>

                <div class="text-content">
                    <strong>BEFORE ME,</strong> a Notary Public, for the Province and City of Iloilo, this 
                    <strong>[DATE OF NOTARIZATION]</strong> personally appeared:
                </div>

                <table class="ack-table">
                    <tr>
                        <td><strong>Name</strong></td>
                        <td><strong>Identification No.</strong></td>
                        <td><strong>Date/Place of Issue</strong></td>
                    </tr>
                    <tr>
                        <td><input type="text" class="field-input" id="seller-name-ack" placeholder="NAME OF SELLER" style="width: 100%;"></td>
                        <td><input type="text" class="field-input" id="seller-id" placeholder="" style="width: 100%;"></td>
                        <td><input type="text" class="field-input" id="seller-id-date" placeholder="" style="width: 100%;"></td>
                    </tr>
                    <tr>
                        <td><input type="text" class="field-input" id="buyer-name-ack" placeholder="NAME OF BUYER" style="width: 100%;"></td>
                        <td><input type="text" class="field-input" id="buyer-id" placeholder="" style="width: 100%;"></td>
                        <td><input type="text" class="field-input" id="buyer-id-date" placeholder="" style="width: 100%;"></td>
                    </tr>
                </table>

                <div class="text-content">
                    all known to me to be the same persons who executed the foregoing instrument and hereby acknowledged to me that the same is their free and voluntary act and deed.
                </div>

                <div class="text-content">
                    This instrument consisting of two (2) pages, including this page on which this acknowledgment is written refers to a <strong>DEED OF SALE of [NUMBER OR UNIT(S)] Unit of [MAKE, MODEL, BODY]</strong> and has been signed by the parties and their witnesses and sealed with my notarial seal.
                </div>

                <div class="notary-section">
                    <div style="margin-top: 30px;">Witness my hand and Notarial seal.</div>
                    
                    <div style="margin-top: 40px; display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                        </div>
                        
                        <div style="flex: 1; text-align: center;">
                            <div class="notary-stamp">
                                <div class="notary-seal">
                                    <div class="seal-circle">
                                        <div class="seal-text-top">JANE J. DOE</div>
                                        <div class="seal-center">
                                            <span style="font-size: 10px;">NOTARIAL</span><br>
                                            <span style="font-weight: bold; font-size: 14px;">SEAL</span>
                                        </div>
                                        <div class="seal-text-bottom">STATE OF MONTANA</div>
                                    </div>
                                </div>
                                <div class="notary-info">
                                    <strong>JANE J. DOE</strong><br>
                                    NOTARY PUBLIC for the<br>
                                    State of Montana<br>
                                    Residing at Helena, Montana<br>
                                    My Commission Expires:<br>
                                    January 21, 2029
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePreview()">&times;</span>
            <h2>Document Preview</h2>
            <div id="previewContent"></div>
        </div>
    </div>

    <script>
        let isEditing = false;
        let canvases = {};

        // Initialize signature canvases
        function initCanvas(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return; // Skip if canvas doesn't exist
            
            const ctx = canvas.getContext('2d');
            let drawing = false;

            canvases[canvasId] = { canvas, ctx };

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);

            function startDrawing(e) {
                drawing = true;
                const rect = canvas.getBoundingClientRect();
                ctx.beginPath();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            }

            function draw(e) {
                if (!drawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            function stopDrawing() {
                drawing = false;
            }

            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
        }

        // Initialize all canvases
        initCanvas('sellerCanvas');
        initCanvas('buyerCanvas');

        function clearSignature(canvasId) {
            const { canvas, ctx } = canvases[canvasId];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function toggleEdit() {
            isEditing = !isEditing;
            const inputs = document.querySelectorAll('.field-input');
            const btn = document.querySelector('.btn-edit');
            
            inputs.forEach(input => {
                input.readOnly = !isEditing;
                if (isEditing) {
                    input.classList.add('editing');
                } else {
                    input.classList.remove('editing');
                }
            });

            btn.textContent = isEditing ? 'üíæ Save' : '‚úèÔ∏è Edit Document';
            btn.style.background = isEditing ? '#FF9800' : '#4CAF50';
        }

        function previewDocument() {
            const modal = document.getElementById('previewModal');
            const previewContent = document.getElementById('previewContent');
            const doc = document.getElementById('document');
            
            previewContent.innerHTML = doc.innerHTML;
            
            // Replace canvases with images in preview
            const canvasIds = ['sellerCanvas', 'buyerCanvas'];
            canvasIds.forEach(id => {
                const originalCanvas = document.getElementById(id);
                const previewCanvas = previewContent.querySelector(`#${id}`);
                if (previewCanvas && originalCanvas) {
                    const img = document.createElement('img');
                    img.src = originalCanvas.toDataURL();
                    img.className = 'signature-img';
                    previewCanvas.parentNode.replaceChild(img, previewCanvas);
                }
            });

            // Hide clear buttons in preview
            const clearBtns = previewContent.querySelectorAll('.clear-btn');
            clearBtns.forEach(btn => btn.style.display = 'none');

            modal.style.display = 'block';
        }

        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
        }

        async function downloadPNG() {
            try {
                const doc = document.getElementById('document');
                
                // Temporarily hide clear buttons
                const clearBtns = doc.querySelectorAll('.clear-btn');
                clearBtns.forEach(btn => btn.style.display = 'none');

                // Show loading indicator
                const btn = document.querySelector('.btn-download-png');
                const originalText = btn.textContent;
                btn.textContent = '‚è≥ Generating PNG...';
                btn.disabled = true;

                // Wait a moment for UI to update
                await new Promise(resolve => setTimeout(resolve, 100));

                const canvas = await html2canvas(doc, {
                    scale: 3,
                    useCORS: true,
                    allowTaint: true,
                    logging: false,
                    backgroundColor: '#ffffff',
                    width: doc.scrollWidth,
                    height: doc.scrollHeight,
                    windowWidth: doc.scrollWidth,
                    windowHeight: doc.scrollHeight
                });

                // Show clear buttons again
                clearBtns.forEach(btn => btn.style.display = 'inline-block');

                // Create download link
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.download = 'deed-of-sale-' + Date.now() + '.png';
                    link.href = url;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);

                    // Reset button
                    btn.textContent = originalText;
                    btn.disabled = false;
                    alert('PNG downloaded successfully!');
                }, 'image/png');

            } catch (error) {
                console.error('Error generating PNG:', error);
                alert('Error generating PNG. Please try again.');
                const btn = document.querySelector('.btn-download-png');
                btn.textContent = 'üì∑ Download PNG';
                btn.disabled = false;
                
                // Show clear buttons again
                const clearBtns = document.querySelectorAll('.clear-btn');
                clearBtns.forEach(btn => btn.style.display = 'inline-block');
            }
        }

        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = document.getElementById('document');
            
            // Temporarily hide clear buttons
            const clearBtns = doc.querySelectorAll('.clear-btn');
            clearBtns.forEach(btn => btn.style.display = 'none');

            const canvas = await html2canvas(doc, {
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            });

            // Show clear buttons again
            clearBtns.forEach(btn => btn.style.display = 'inline-block');

            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            const imgWidth = 210;
            const pageHeight = 297;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            let heightLeft = imgHeight;
            let position = 0;

            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;

            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }

            pdf.save('deed-of-sale.pdf');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('previewModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>